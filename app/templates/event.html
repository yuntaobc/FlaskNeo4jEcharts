{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf%}

{% block title %}Events{% endblock %}

{% block head %}{{ super() }}{% endblock %}

{% block body %}{{ super() }}{% endblock %}

{% block scripts %}
    <script src="/static/query.js"></script>
{% endblock scripts %}

{% block content %}
<div class="jumbotron">
    <h1>Event graph</h1>
    <p>1. To see how many people PARTICIPARE in this event</p>
    <p>2. To see how many topics PRODUCE from this event</p>
    <p>3. To see level n neighbor to this event</p>
    <p>4. To see top n topic related to this event</p>
    <p><a class="btn btn-lg btn-primary" href="" role="button">View docs &raquo;</a></p>
</div>
<div class="jumbotron">
    <h1>Event search.</h1>
    <form class="form form-horizontal" method="post" role="form">
        <div class="form-item">
            <div class="form-item-label">
<!--                {{ form.name.label }}-->
            </div>
            <div class="form-item-content-wrapper">
                <input id="event-id" type="hidden" value="">
                {{ form.name() }}
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-label">
                <span>Time from:</span>
            </div>
            <div class="form-item-content-wrapper">
                <span class="form-calender-picker">
                     <div class="row">
                    <div class="form-item-input col-sm-6">{{ form.s_time() }}</div>
                    <i class="glyphicon glyphicon-calendar"></i>
                     </div>
                </span>
            </div>
        </div>
        <div class="form-item">
            <div class="form-item-label">
                <span>to</span>
            </div>
            <div class="form-item-content-wrapper">
                <span class="form-calender-picker">
                     <div class="row">
                    <div class="form-item-input col-sm-6">{{ form.e_time() }}</div>
                    <i class="glyphicon glyphicon-calendar"></i>
                     </div>
                </span>
            </div>
        </div>
        <input type="button" id="submit" onclick="event_user()" value="查 询" >
    </form>
</div>
<div class="jumbotron">
    <h1>Search result.</h1>
    <div id="result" style="width: 1000px;height:500px;"></div>
</div>
<script>


$("#name-input").typeahead({
    source:function(query, process){
        var data = JSON.stringify({'name':query});
        $.ajax({
            type:"POST",
            url:"/api/event/list",
            contentType: "application/json;charset=utf-8",
            data:data,
            //dataType:"json",
            error:function(data){
               console.log("error")
               console.log(data);
            },
         success:function(data){
            // data like [{event_id: 33, name: "#anger"},{event_id: 10, name: "#andywarhol"}]
            // need to display event id
            data = data[0];
            process(data);
          }// success
        })// ajax
    },//source
    displayText:function(item){
	    return item.name;
	}
})
$("#name-input").change(function() {
  var current = $("#name-input").typeahead("getActive");
  if (current) {
    // console.log(current)
    $("#event-id").val(current.event_id);
    // Some item from your model is active!
    if (current.name == $("#name-input").val()) {
      // This means the exact match is found. Use toLowerCase() if you want case insensitive match.
    } else {
      // This means it is only a partial match, you can either add a new item
      // or take the active if you don't want new items
    }
  } else {
    // Nothing is active so it is a new value (or maybe empty value)
  }
});

$('#s-time').datetimepicker({
    format: 'YYYY-MM-DD HH:MM'
});
$('#e-time').datetimepicker({
    format: 'YYYY-MM-DD HH:MM'
});
</script>
{% endblock content %}

